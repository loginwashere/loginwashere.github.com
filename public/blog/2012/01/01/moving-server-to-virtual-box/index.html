
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Moving server to Virtual box or wildcard virtual domains - Dmitriy Savchenko</title>
  <meta name="author" content="Dmitriy Savchenko">

  
  <meta name="description" content="Currently i work with LAMP stack and therefore i&#8217;m used to creating virtual hosts for all projects, even small ones.
Assuming that development &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://loginwashere.github.com/blog/2012/01/01/moving-server-to-virtual-box">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dmitriy Savchenko" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10157693-11']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dmitriy Savchenko</a></h1>
  
    <h2>Don't panic</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:loginwashere.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Moving Server to Virtual Box or Wildcard Virtual Domains</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-01T00:15:00+02:00" pubdate data-updated="true">Jan 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="http://i.imgur.com/nAByQ.png"></p>

<p>Currently i work with LAMP stack and therefore i&#8217;m used to creating virtual hosts for all projects, even small ones.
Assuming that development is going on Ubuntu, Virtual Host creation is quite quick and easy operation.</p>

<!-- more -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Create project public folder</span>
</span><span class='line'>mkdir /home/%username%/vhosts/%sitename%
</span><span class='line'>
</span><span class='line'><span class="c"># Create file, that will be containing virtual Host description</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># In Ubuntu Virtual Host descriptions are stored in folder</span>
</span><span class='line'><span class="c"># /etc/apache2/sites-available/ one host per file</span>
</span><span class='line'>
</span><span class='line'>sudo vi /etc/apache2/sites-available/%sitename%
</span></code></pre></td></tr></table></div></figure>


<p>ATTENTION:
If you don&#8217;t like vi, vim or whatever
you can create and edit file with any editor you like.</p>

<p>If you started vi and don&#8217;t know how to exit press <Esc> and then type :q and press <Enter></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Add record describing Virtual Host</span>
</span><span class='line'>&lt;VirtualHost *:80&gt;
</span><span class='line'>    ServerName %sitename%
</span><span class='line'>    ServerAlias %sitename%
</span><span class='line'>    DocumentRoot /home/lwh/vhosts/%sitename%
</span><span class='line'>&lt;/VirtualHost&amp;gt
</span><span class='line'>
</span><span class='line'><span class="c"># (Instead of creating you can copy default file and then edit it)</span>
</span><span class='line'><span class="c"># sudo cp /etc/apache2/sites-avalable/default /etc/apache2/sites-available/%sitename%</span>
</span><span class='line'>
</span><span class='line'><span class="c"># &quot;Enabling site&quot;</span>
</span><span class='line'><span class="c"># Create link from /etc/apache2/sites-available/%sitename%</span>
</span><span class='line'><span class="c"># to /etc/apache2/sites-enabled/%sitename%</span>
</span><span class='line'>sudo a2ensite %sitename%
</span><span class='line'>
</span><span class='line'><span class="c"># To apply changes reload or reboot apache with a command</span>
</span><span class='line'>sudo service apache reload
</span><span class='line'>
</span><span class='line'><span class="c"># Add sitename ofyoursite to hosts file</span>
</span><span class='line'><span class="c"># 127.0.0.1 %sitename%</span>
</span><span class='line'>sudo vi /etc/hosts
</span></code></pre></td></tr></table></div></figure>


<p>Just five commands and you can access site on http://%sitename%.
But this proccess can be simplified.</p>

<p>Вроде бы ничего сложного, но когда создаешь н-адцатый проект, начинаешь задумываться об автоматизации и еще большем
упрощении процедуры. Можно создать скрипт, который сведет все к запуску скрипта и вводу названия проекта,
дополнительный параметров.</p>

<p>Кому-то это решение покажется достаточным, но я искал путь с еще меньшим количеством телодвижений.
При этом хотелось разделить сервер и рабочую машину и иметь возможность работать над проектами как из Ubuntu так и из Windows.
Так как компьютер у меня один, то для отделния сервера решил использовать Virtual Box.
Установив на виртуальную машину Ubuntu Server столкнулся с задачей доступа к виртуальным хостам виртуальной машины.
При поиске решения наткнулся на замечательную программу dnsmasq – простой в использовании и настройкt DNS и DHCP сервер.</p>

<p>Следует отметить, что сеть на виртуально машине у меня настроена так: NAT (Network Address Translation) для
доступа в интернет для всяких обновлений и установок новых пакетов (При этом подключении нет доступа из хоста к гостю)
и виртуальный адаптер хоста (Host-only Adapter) для обеспечения связи между хостом и гостем.
Для настройки сети сос стороны хоста я только отметил нужные пункты в настройках сети Virtual Box.
Затем, при запустке виртуальной машины на хосте создался адаптер с названием vboxnet0 в Ubuntu и
VirtualBox Host-Only Network в Windows. Это довольно неприятная особенность Virtual Box мешает легкому
использованию одной виртуальной машины на разных хостах если одним из адаперов является виртуальный адаптер хоста.
Также отличается ip адрес этого адаптера по умолчанию (В Windows назначается 192.168.137.1, в то время как в Ubuntu 192.168.56.1).
С чем связаны эти различия я не знаю, но нужно иметь их ввиду.
Для хоста я выбрал ip 192.168.137.1, для гостя – 192.168.137.3.</p>

<p>На госте NAT адаптер получает настройки сети автоматически и работает сразу из каробки.
Добавить адаптер для виртуального адаптера хоста на гость можно добавив настройки в файл /etc/network/interfaces</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># eth0 - default unterface, used for NAT</span>
</span><span class='line'><span class="c"># therefore for new interface i choose name eth1</span>
</span><span class='line'><span class="c"># If you already have interface with that name - choose another name.</span>
</span><span class='line'>auto eth1
</span><span class='line'>iface eth1 inet static
</span><span class='line'><span class="c"># guest ip</span>
</span><span class='line'>address 192.168.137.3
</span><span class='line'><span class="c"># host ip</span>
</span><span class='line'>gateway 192.168.137.1
</span><span class='line'>netmask 255.255.255.0
</span></code></pre></td></tr></table></div></figure>


<p>If you want apply these settings you need to execute command</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /etc/init.d/networking restart
</span></code></pre></td></tr></table></div></figure>


<p>Install dnsmasq on virtual mashine</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install dnsmasq
</span></code></pre></td></tr></table></div></figure>


<p>и получаем DNS сервер, который будет обрабатывать запросы к виртуальной машине и отдавать виртуальные хосты.
По этой ссылке можно посмотреть настройки программы, их описание и некоторые примеры.</p>

<p>Among them we are interested in next settings:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ip адрес - это ip адрес гостя</span>
</span><span class='line'><span class="c"># Первый параметр посылает все запросы к *.site.local на 192.168.137.3</span>
</span><span class='line'><span class="nv">address</span><span class="o">=</span>/site.local/192.168.137.3
</span><span class='line'><span class="c"># Второй - определяет запросы на какой адрес будет слушать DNS сервер</span>
</span><span class='line'>listen-address<span class="o">=</span>192.168.137.3
</span></code></pre></td></tr></table></div></figure>


<p>Их нужно раскомментировать и заменить ip адрес на адрес виртуальной машины(192.168.137.3), и выбрать название для домена,
на котором у вас будут находиться локальные проекты(site.local).</p>

<p>Чтобы воспользоваться DNS сервером необходимо проинформировать о его существовании виртуальную машину.
Для этого на госте откроем файл
Open file on guest mashine</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo vi /etc/resolv.conf
</span></code></pre></td></tr></table></div></figure>


<p>and add record about server</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># This line should be placed in the beggining of file.</span>
</span><span class='line'>nameserver 192.168.137.3
</span></code></pre></td></tr></table></div></figure>


<p>Also you need to add new DNS server record on host</p>

<p>Теперь возмемся за apache. Для облегчения создания виртуальных хостов воспользуемся его модулем mod_vhost_alias.
Этот модуль позволит создавать виртуальный хост простым созданием директории. Включить его можно следующей командой</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo a2enmod vhost_alias
</span></code></pre></td></tr></table></div></figure>


<p>Create Virtual Host. Your projects will be accessible on it&#8217;s subdomains.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo vi /etc/apache2/sites-available/site.local
</span><span class='line'><span class="c"># Add next lines to this file</span>
</span><span class='line'>&lt;VirtualHost *:80&gt;
</span><span class='line'>    ServerName site.local
</span><span class='line'>    ServerAlias *.site.local
</span><span class='line'>    VirtualDocumentRoot /home/%username%/vhosts/%1
</span><span class='line'>&lt;/VirtualHost&amp;gt
</span><span class='line'><span class="c"># Do not forget to reload or restsrt apache</span>
</span><span class='line'>sudo service apache reload
</span></code></pre></td></tr></table></div></figure>


<p>Lets check if everything works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /home/%username%/vhosts/test
</span><span class='line'><span class="nb">echo</span> &lt;h1&gt;Hello Virtual Host&lt;/h1&gt; &gt; /home/%username%/vhosts/test/index.php
</span></code></pre></td></tr></table></div></figure>


<p>Now you can open in browser page http://test.site.local and see text: &#8220;Hello Virtual Host&#8221;.
Congratulations - you&#8217;ve made your life a bit easier.</p>

<p>Links</p>

<pre><code>* dnsmasq settings explained
* Мультидоменность в Apache без лишних хлопот на локальном хосте
* http://httpd.apache.org/docs/2.0/mod/mod_vhost_alias.html
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dmitriy Savchenko</span></span>

      








  


<time datetime="2012-01-01T00:15:00+02:00" pubdate data-updated="true">Jan 1<span>st</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/virtualbox/'>VirtualBox</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://loginwashere.github.com/blog/2012/01/01/moving-server-to-virtual-box/" data-via="loginwashere" data-counturl="http://loginwashere.github.com/blog/2012/01/01/moving-server-to-virtual-box/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/12/31/start-playing-with-zend-framework-2/" title="Previous Post: Start playing with Zend Framework 2">&laquo; Start playing with Zend Framework 2</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/01/07/virtualbox-guest-additions-reinstall/" title="next Post: VirtualBox guest additions reinstall">VirtualBox guest additions reinstall &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/07/virtualbox-guest-additions-reinstall/">VirtualBox guest additions reinstall</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/01/moving-server-to-virtual-box/">Moving server to Virtual box or wildcard virtual domains</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/31/start-playing-with-zend-framework-2/">Start playing with Zend Framework 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/24/simple-static-blog-using-octopress/">Simple static blog using Octopress</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/loginwashere">@loginwashere</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'loginwashere',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("loginwashere", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/loginwashere" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @loginwashere</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/105401979618043032150?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Dmitriy Savchenko -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dontpanic42';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://loginwashere.github.com/blog/2012/01/01/moving-server-to-virtual-box/';
        var disqus_url = 'http://loginwashere.github.com/blog/2012/01/01/moving-server-to-virtual-box/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
